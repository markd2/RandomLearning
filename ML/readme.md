# ML

Suggestions from Kenson:

* Sentdex
* nnfs.io
* https://neuralnetworksanddeeplearning.com/index.html
* Sebastian lague
  - https://youtu.be/hfMk-kjRv4c

And from others

* https://course.fast.ai/

I managed to snag the book (book? what's that?) - O'Reilly _Hands-on
machine learning with scikit-Learn, Keras, and TensorFlow_

Make a test set and then never look at it - to prevent data-snooping bias



--------------------------------------------------
# Core ML Stuff

https://developer.apple.com/documentation/coreml

* use CoreML to integrate machien learning moels into your app
* unified representation for all models
* use CoreML API and user data to make predictions
* can also train/fine-tune models on a device
* used CPU, GPU and Neural Engine(tm)
* run strictly on-dvice, avoid network, keep data private, app responsive
* APIs like Vision, Natural Language, Speech, and sound analysis are based
  on CoreML
* built on top of Accelerate, BNNS (acelerate framework collection for
  constructing neural networks for training and inference), and Metal
  Performance Shaders
  - "Bayesian Neural Networks"

Apple provides some models already in coreML format:
  - https://developer.apple.com/machine-learning/models/

Core ML Tools
  - for converting models from TensorFlow, PyTorch and other libs
  - https://apple.github.io/coremltools/docs-guides/source/introductory-quickstart.html

Tootz
  - https://towardsdatascience.com/creating-an-ios-app-with-core-ml-from-scratch-b9e13e8af9cb
  - ML Feedback loop
    - Get initial data (once)
    - ...
    - label data
    - train model
    - test model
    - run model in production
    - get new data (and repeat)
  - workflow is
    - caffe/keras/libsvm/turi/etc -> Core ML Tools (pythong) -> MLModel
  - more of a "how to make a model / adapt existing mode"
    - much more pythong code than iOS

AppCoda

  - https://www.appcoda.com/coreml-introduction/
    - vast majority is non-ML iOS boilerplate
  - uses Inception v3
    - https://github.com/hollance/Inception-CoreML/blob/master/Inception/Inceptionv3.mlmodel
  - supposedly you can look at the generate Inceptionv3 swift class, but
    xcode just beeps at me.
  - can make a local thingie and then go to definition
    -  `let blah = Inceptionv3(configuration: <#T##MLModelConfiguration#>)`

Classes
* MLFeatureProvider
  - https://developer.apple.com/documentation/coreml/mlfeatureprovider
  - https://stackoverflow.com/questions/54425495/coreml-how-to-create-a-simple-mlfeatureprovider-class
  - interface that represents a collection of values for either a models input
    or its output
  - use to customize the way your app gets data to and from your model when
    the dynamicaly generated interface doesn't meet your needs
  - adopt this when
    - data is collected asynchronously
    - using the autogenerated interface leads to copying excessive amounts of data
    - your data source is otherwise complicated
  - the intrerface is mainly an accessor to MLFeatureValue instances
  - adopting this allows you to integrate your data directly with MLModel
  - model can query your data sources without constructing a separate input instnace
  - To custsomize app's interaction with a model:
    - adopt MLFeatureProvider protocol in a class or struct so that the model
      can query it for input feature values via `featureValue(for:)`
    - pass your app's MLFeatureProvider to your MLModel via
      `prediction(from:)` or `prediction(from:options:)`
    - use the MLFeatureProvider returned from a prediction(from:) to get the
      output feature values for the prediction
      - coreML defines this, so really only need to define one
  - MLDictionaryFeatureProvider

```
public protocol MLFeatureProvider {
    var featureNames: Set<String> { get }
    
    /// Returns nil if the provided featureName is not in the set of featureNames
    func featureValue(for featureName: String) -> MLFeatureValue?
}
```

* MLFeatureType
  - possible types for feature values, input features, and output features
  - int64, double
  - image
  - multiArray - multidimensional
  - string, dictionary, sequence
  - invalid
  - MLShapedArray
    - stores scalar values in a multidimensional array
  - MLMultiArray
    - stores numeric values in an array with multiple dimensions
  - MLSequence
    - a series of strings or integers

* MLFeatureValue
  - generic wrapper around an underlying value and the value's type
  - one of teh types MLFeatureType defines
  - usually access feature values indirectly using methods in the generated wrapper 
    class
  - if access an MLModel directly, must c reate and consume MLFeatureProvider 
    instances
  - for each prediction, CoreML accepts a feature provider for its inputs,
    and generates a seaprate feature provider for its outputs
  - the input feature provider has one MLFeatureValue instance per input
  - the ouput feature provider contains one per output
  - a bunch of inits, like init(int64:), init(string:)
  - multidimensional
    - `init(multiArray: MLMultiArray)`
    - `init<Scalar>(shapedArray: MLShapedArray<Scalar>)`
  - collection
    - `init(dictionary: [AnyHashable: NSNumber])`
    - `init(sequence: MLSequence)
  - undefined
    - `init(undefined: MLFeatureType)`
  - and a _bunch_ of image-related ones
    - `init(pixelBuffer: CVPixelBuffer)`
    - some with cgimages (
    - one with image at url
  - MLImageConstraint
    - width/height/pixel format
  - MLFeatureValue.ImageOption
    - initializer options can use to crop and scale an image when creating an
      image feature value
  - access the feature's Type via `type`
  - and then a bunch of `isUndefined`, `doubleValue`, `stringValue`, etc
  - can compare with `isEqual(to:)`

* MLMultiArray
  - multi-dimensional array
  - all elements are one of the same type
     - int32
     - float16
     - float32
     - float64
  - shape is an integer array that has an element for each dimension
    in the multiarray
  - to inspect the shape and constraints of an input or output feature
    - access the modelDescription
    - find the multiarray input or output feature
    - access the fetaure descriptions multiArrayConstraint
    - inspect the constraint's shape and shapeConstraint



* MLBatchProvider
