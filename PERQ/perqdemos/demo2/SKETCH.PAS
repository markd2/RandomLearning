{---------------------------------------------------------------}{                                                               }{   Sketch - Perq sketching doodler.                            }{             J. P. Strait     2 May 80.                        }{                                                               }{---------------------------------------------------------------}program Sketch;  imports System from System; imports IOErrors from IOErrors; imports IO_Unit from IO_Unit; imports IO_Others from IO_Others; imports Memory from Memory; imports Raster from Raster; imports Screen from Screen; imports GPIB from GPIB;    const MinX = 10;      MaxX = 757;      MinY = 100;      MaxY = 1013;      var X, Y, OldX, OldY: integer;    OldSwitch: boolean;    Quitting: boolean;    Option: char;    DrawWithSwitchUp: boolean;     procedure SystemTitle(n: integer); begin { SystemTitle }  Write(Chr(#014));          { FormFeed - clear the screen }  if n <> 0 then Write(' ':n);  Writeln('Perq User Interface.  Version ', MainVersion, '.', SystemVersion:1) end { SystemTitle }; procedure Clear; begin { Clear }  RasterOp(RXor, MaxX - MinX + 1, MaxY - MinY + 1,           MinX, MinY, 48, MakePtr(ScreenSeg,0,RasterPtr),           MinX, MinY, 48, MakePtr(ScreenSeg,0,RasterPtr)) end { Clear };  procedure Initialize; begin { Initialize }  Rewrite(Output);  Reset(Input);  Quitting := false;  X := 384;  Y := 512;  OldX := X;  OldY := Y;  OldSwitch := TabSwitch;  IOSetCursorPos(X, Y);  IOSetModeTablet(relTablet);  IOCursorMode(IndepCursor);  Option := 'S';  DrawWithSwitchUp := false;  SystemTitle(1);  Writeln;  Writeln(' "Q"  return to command level.           "C"  clear the screen.');  Writeln(' "S"  sketch mode - continuous drawing.  "M"  move without drawing.');  Writeln(' "+"  sketch with switch down.           "-"  sketch with switch up.');  Writeln(' "L"  draw a straight line every time tablet switch is pressed.');  Line(DrawLine,MinX-1,MinY-1,MaxX+1,MinY-1,MakePtr(ScreenSeg,0,RasterPtr));  Line(DrawLine,MaxX+1,MinY-1,MaxX+1,MaxY+1,MakePtr(ScreenSeg,0,RasterPtr));  Line(DrawLine,MaxX+1,MaxY+1,MinX-1,MaxY+1,MakePtr(ScreenSeg,0,RasterPtr));  Line(DrawLine,MinX-1,MaxY+1,MinX-1,MinY-1,MakePtr(ScreenSeg,0,RasterPtr)) end { Initialize };   procedure KeyCheck; var Status: integer;     Ch: char; begin { KeyCheck }  Status := IOCRead(TransKey,Ch);  if Status <> IOEIOB then   if Status = IOEIOC then    begin     if Ch in ['a'..'z'] then Ch := Chr(Ord(Ch) - Ord('a') + Ord('A'));     case Ch of      'C': Clear;      'Q': begin Quitting := true;            SystemTitle(0);            Writeln('Type HELP if you need it.')           end;      '-',      '+': DrawWithSwitchUp := Ch = '-';      'S',      'M': Option := Ch;      'X',      'L': begin Option := Ch;            OldX := X;            OldY := Y           end;      'N': gpTbltOn;      'F': gpTbltOff;      otherwise:      end    end end { KeyCheck };          begin { Sketch } Initialize; repeat IOReadTablet(X,Y);  if (X < MinX) or (X > MaxX) then    if X < MinX then X := MinX else X := MaxX;  if (Y < MinY) or (Y > MaxY) then    if Y < MinY then Y := MinY else Y := MaxY;  IOSetCursorPos(X, Y);  case Option of   'S': begin         if DrawWithSwitchUp <> TabSwitch then          Line(DrawLine,OldX,OldY,X,Y,MakePtr(ScreenSeg,0,RasterPtr));         OldX := X;         OldY := Y        end;   'M': begin OldX := X; OldY := Y end;   'L': if TabSwitch and not OldSwitch then         begin Line(DrawLine,OldX,OldY,X,Y,MakePtr(ScreenSeg,0,RasterPtr));          OldSwitch := true;          OldX := X;          OldY := Y         end;   'X': if TabSwitch and not OldSwitch then         begin OldX := X; OldY := Y end        else Line(XorLine,OldX,OldY,X,Y,MakePtr(ScreenSeg,0,RasterPtr))   end;  OldSwitch := TabSwitch;  KeyCheck until Quittingend { Sketch }.