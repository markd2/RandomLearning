Module WindowLib;{ ******************************************      Perq Screen Window Routine Library      Three Rivers Computer Corporation  Pittsburgh, Pa. 15217   Copyright (c) 1980  Written by: Ralph Guggenheim  ****************************************** }EXPORTSProcedure ClearWindow(X, Y, Width, Height : integer);Procedure FillWindow (X, Y, Width, Height : integer);Procedure MoveWindow(SrcX, SrcY, Width, Height, DstX, DstY : integer);Procedure CopyWindow(SrcX, SrcY, Width, Height, DstX, DstY : integer);PRIVATEImports Memory from Memory;Imports Raster from Raster;Function Clip(val, lobound, hibound : integer) : integer;  begin {Clip}  if val < lobound then val := lobound    else if val > hibound then val := hibound;  Clip := val;  end {Clip};{ Common code for fill and clear window routines }Procedure DoWindow(Func, X, Y, Width, Height : integer);  var tmp : integer;      lrx, lry : integer;    { lower right coords of window }  begin {ClrWindow}  X := Clip(X, 0, 767);  lrx := Clip(X + Width, 0, 767);  Y := Clip(Y, 0, 1023);  lry := Clip(Y + Height, 0, 1023);  RasterOp(Func, lrx - X + 1, lry - Y + 1,   X, Y, 48, MakePtr(ScreenSeg, 0, RasterPtr),   X, Y, 48, MakePtr(ScreenSeg, 0, RasterPtr));  end {DoWindow};{ Clear a window }Procedure ClearWindow;  begin  DoWindow(RXor, X, Y, Width, Height);  end;{ Fill a window }Procedure FillWindow;  begin {FillWindow}  DoWindow(RXNor, X, Y, Width, Height);  end {FillWindow};Procedure CopyWindow;  var ulx, uly, lrx, lry : integer;    { upper right, lower left coords }  begin {CopyWindow}  { Clip source window }  ulx := Clip(SrcX, 0, 767);  uly := Clip(SrcY, 0, 1023);  lrx := Clip(SrcX + Width, 0, 767);  lry := Clip(SrcY + Height, 0, 1023);  { Generate clipped Height and Width }  Width := lrx - ulx;  Height := lry - uly;  { Correct dst values for clipped sources }  DstX := DstX + ulx - SrcX;  DstY := DstY + uly - Srcy;    { Clip the new destination window }  DstX := Clip(DstX, 0, 767);  DstY := Clip(DstY, 0, 1023);  Width := Clip(DstX + Width, 0, 767) - DstX + 1;  Height := Clip(DstY + Height, 0, 1023) - DstY + 1;  RasterOp(RRpl, Width, Height,   DstX, DstY, 48, MakePtr(ScreenSeg, 0, RasterPtr),   SrcX, SrcY, 48, MakePtr(ScreenSeg, 0, RasterPtr));  end {CopyWindow};Procedure MoveWindow;  var SHiX, SHiY, DHiX, DHiY, Code : integer;  begin {MoveWindow}  CopyWindow(SrcX, SrcY, Width, Height, DstX, DstY);  { Calculate the missing coordinates for source and dest }  SHiX := SrcX + Width;  SHiY := SrcY + Height;  DHiX := DstX + Width;  DHiY := DstY + Height;    { Generate a bit code of window overlaps }  Code := 0;  if (SrcX <= DstX) and (DstX <= SHiX) then code := LOr(Code, 1);  if (SrcX <= DHiX) and (DHiX <= SHiX) then code := LOr(Code, 2);  if (SrcY <= DstY) and (DstY <= SHiY) then code := LOr(Code, 4);  if (SrcY <= DHiY) and (DHiY <= SHiY) then code := LOr(Code, 8);  { Clear windows according to the bit codes.    Each code specifies the type of overlap (see comments) }  case Code of     5: begin { DstX, DstY in source window } ClearWindow(SrcX, SrcY, DstX - SrcX - 1, Height); ClearWindow(DstX, SrcY, SHiX - DstX + 1, DstY - SrcY - 1); end;     6: begin { upper right corner of dest in source } ClearWindow(SrcX, SrcY, DHiX - SrcX + 1, DstY - SrcY - 1); ClearWindow(DHiX + 1, SrcY, SHiX - DHiX, Height); end;     7: { top of dest in source } ClearWindow(SrcX, SrcY, SHix - SrcX, DstY - SrcY);     9: begin { bottom left of dest in source } ClearWindow(SrcX, SrcY, DstX - SrcX - 1, Height); ClearWindow(DstX, DHiY + 1, SHiX - DstX, SHiY - DHiY); end;    10: begin { bottom right of dest in source } ClearWindow(SrcX, DHiY + 1, DHiX - SrcX + 1, SHiY - DHiY); ClearWindow(DHiX + 1, SrcY, SHiX - DHiX, Height); end;    11: { bottom of dest in source } ClearWindow(SrcX, DHiY + 1, Width, SHiY - DHiY);    13: { left of dest in source } ClearWindow(SrcX, SrcY, DstX - SrcX, Height);    14: { right of dest in source } ClearWindow(DHiX + 1, SrcY, SHiX - DHiX, Height);    15: ;     { Do nothing : windows are identical }    Otherwise: ClearWindow(SrcX, SrcY, Width, Height);    end;  end {MoveWindow}.